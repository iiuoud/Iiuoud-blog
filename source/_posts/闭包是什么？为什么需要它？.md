---
title: é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ
date: 2025-11-20 19:26:35
tags: 
  - JavaScript
  - å‰ç«¯åŸºç¡€
cover: https://cdn.jsdelivr.net/gh/iiuoud/cdn@1.0/closure.jpg
---

# é—­åŒ… â€” è®©å‡½æ•°è®°ä½å®šä¹‰æ—¶çš„ç¯å¢ƒ

## 1ï¸âƒ£ é—®é¢˜å¼•å…¥

1. ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ
2. å®ƒä¸ºä»€ä¹ˆæœ‰ç”¨ï¼Ÿ
3. é—­åŒ…çš„æœ¬è´¨æ˜¯â€œå‡½æ•°è®°ä½å¤–éƒ¨ä½œç”¨åŸŸå˜é‡çš„èƒ½åŠ›â€ï¼Œä½†ä¸ºä»€ä¹ˆ JavaScript å…è®¸è¿™æ ·ï¼Ÿ
4. åœ¨ Javascript ä¸­å¦‚ä½•åˆ›å»ºç§æœ‰å˜é‡ï¼Ÿ

## 2ï¸âƒ£ é—­åŒ…çš„æ¦‚å¿µ

åœ¨ Javascript ä¸­ï¼Œé—­åŒ…æ˜¯**ä¸€ä¸ªå‡½æ•°å’Œå£°æ˜è¯¥å‡½æ•°çš„è¯æ³•ç¯å¢ƒçš„ç»„åˆ**ã€‚è¿™ä¸ªç¯å¢ƒåŒ…å«äº†é—­åŒ…åˆ›å»ºæ—¶åœ¨ä½œç”¨åŸŸçš„ä»»ä½•å±€éƒ¨å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé—­åŒ…å°±æ˜¯â€œ**å‡½æ•° + å®ƒåˆ›å»ºæ—¶å‘¨å›´çš„ç¯å¢ƒ**â€ï¼Œå¯ä»¥ç†è§£ä¸ºå‡½æ•°èƒŒç€ä¸€ä¸ªå°èƒŒåŒ…ï¼Œé‡Œé¢è£…ç€å®ƒå‡ºç”Ÿæ—¶èº«è¾¹çš„å˜é‡æ‰€åœ¨çš„è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ï¼Œå³ä½¿å‡½æ•°ç¦»å¼€äº†å®ƒåŸæ¥çš„ç¯å¢ƒï¼Œå®ƒçš„å°èƒŒåŒ…ä»ç„¶å¯ä»¥è¢«ä½¿ç”¨ã€‚

é—­åŒ…æ•è·çš„æ˜¯â€œå˜é‡çš„**å¼•ç”¨**ï¼ˆreferenceï¼‰â€ï¼Œè€Œä¸æ˜¯å˜é‡çš„å€¼ï¼ˆvalueï¼‰ã€‚

> è¯æ³•ä½œç”¨åŸŸ = ä½œç”¨åŸŸåœ¨ä»£ç å†™å‡ºæ¥ï¼ˆå®šä¹‰ï¼‰æ—¶å°±å·²ç»ç¡®å®šï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶å†³å®šã€‚
>
> ä¹Ÿå°±æ˜¯è¯´ï¼š
>
> - ä½ åœ¨å“ªé‡Œå†™çš„è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå°±èƒ½è®¿é—®å“ªäº›å˜é‡ã€‚
> - è€Œä¸æ˜¯çœ‹ä½ åœ¨å“ªé‡Œè°ƒç”¨å®ƒã€‚

**ä¸¾ä¸ªğŸŒ°ï¼š**

```JavaScript
function makeCounter() {
    let count = 0
    return function () {
        count++
        return count
    }
}

const counter = makeCounter()
```

1. **å‡½æ•°**

è¿™é‡Œçš„å‡½æ•°æŒ‡çš„æ˜¯**å†…éƒ¨å‡½æ•°**ï¼š

```JavaScript
function () {
  count++
  return count
}
```

å®ƒåªæ˜¯ä¸€ä¸ªä»£ç å—ï¼Œå•ç‹¬å®ƒå¹¶ä¸èƒ½è®¿é—®å¤–éƒ¨çš„`count`ï¼Œå®ƒåªçŸ¥é“æœ‰ä¸€ä¸ªå«`count`çš„å˜é‡ï¼Œåœ¨å®ƒçš„ä½œç”¨åŸŸé“¾ä¸Šã€‚

2. **åˆ›å»ºæ—¶çš„ç¯å¢ƒ**

åˆ›å»ºæ—¶çš„ç¯å¢ƒä¹Ÿå°±æ˜¯`makeCounter`åˆ›å»ºæ—¶çš„ä½œç”¨åŸŸï¼š

```JavaScript
{
    count: 0
}
```

å½“è¿™ä¸ªå†…éƒ¨å‡½æ•°è¢«è¿”å›åˆ°å¤–éƒ¨`counter`æ—¶ï¼Œå®ƒâ€œæºå¸¦â€äº†è¿™ä¸ªç¯å¢ƒï¼Œæ‰€ä»¥ä»ç„¶èƒ½è®¿é—®å’Œä¿®æ”¹`count`ã€‚

3. **å‡½æ•°ç¦»å¼€åŸæ¥çš„ç¯å¢ƒ**

- å†…éƒ¨å‡½æ•°æœ€åˆæ˜¯åœ¨`makeCounter`çš„ä½œç”¨åŸŸä¸­å®šä¹‰çš„ã€‚
- å½“`makeCounter`æ‰§è¡Œå®Œåï¼Œå®ƒçš„**å±€éƒ¨å˜é‡**`count`æœ¬åº”è¢«**é”€æ¯**ã€‚
- ä½†æ˜¯å†…éƒ¨å‡½æ•°è¢«è¿”å›å¹¶å­˜å‚¨åœ¨äº†`counter`ä¸­ï¼Œè¿™ä¸ªå‡½æ•°â€œæºå¸¦â€äº†å®ƒåˆ›å»ºæ—¶çš„å˜é‡ï¼ˆä¹Ÿå°±æ˜¯`count`å€¼å’Œä½œç”¨åŸŸï¼‰ã€‚
- æ‰€ä»¥å½“å†…éƒ¨å‡½æ•°**ç¦»å¼€äº†åŸæœ¬çš„ä½œç”¨åŸŸ**ï¼ˆ`makeCounter`æ‰§è¡Œä¸Šä¸‹æ–‡å·²ç»ç»“æŸï¼‰ï¼Œä»ç„¶å¯ä»¥è®¿é—®å’Œä¿®æ”¹`count`ã€‚

4. **ä½œç”¨åŸŸé“¾å›¾ç¤º**

```Lua
makeCounter()
 â”œâ”€ count = 0
 â””â”€ è¿”å› function() {
        count++
        return count
    }

å†…éƒ¨å‡½æ•°çš„ [[Environment]] æŒ‡å‘ makeCounter çš„ä½œç”¨åŸŸ
```

## 3ï¸âƒ£ æ ¸å¿ƒåŸç† / å·¥ä½œæœºåˆ¶

1. å½“ä½ åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå†…éƒ¨å‡½æ•°ä¼šâ€œè®°ä½â€å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚
2. å³ä½¿å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå†…éƒ¨å‡½æ•°ä¾ç„¶å¯ä»¥é€šè¿‡â€œé—­åŒ…â€è®¿é—®è¿™äº›å˜é‡ã€‚
3. ä½œç”¨åŸŸé“¾å†³å®šäº†å˜é‡è®¿é—®é¡ºåºï¼šå…ˆæ‰¾å†…å®¹ä½œç”¨åŸŸï¼Œå†æŸ¥æ‰¾å¤–éƒ¨ä½œç”¨åŸŸï¼Œç›´åˆ°å…¨å±€ä½œç”¨åŸŸã€‚
4. é—­åŒ…ä¹‹æ‰€ä»¥å­˜åœ¨ï¼Œæ˜¯å› ä¸º JavaScript ä½¿ç”¨çš„æ˜¯**è¯æ³•ä½œç”¨åŸŸï¼ˆlexical scopeï¼‰**ã€‚

## 4ï¸âƒ£ åº”ç”¨åœºæ™¯

1. ### **å®ç°ç§æœ‰å˜é‡**

**ç›®çš„**ï¼šè®©æŸäº›å˜é‡åªèƒ½å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥ä¿®æ”¹

```JavaScript
function createCounter() {
    let count = 0  // ç§æœ‰å˜é‡
    return {
        // è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡
        increment() {
            count++
            return count
        },
        decrement() {
            count--
            return count
        },
        getCount() {
            return count
        }
    }
}

const counter = createCounter()
console.log(counter.increment()) // 1
console.log(counter.increment()) // 2
console.log(counter.getCount())  // 2
console.log(counter.count)       // undefinedï¼Œå¤–éƒ¨æ— æ³•è®¿é—®
```

`count`åªå­˜åœ¨äº`makeCounter`çš„ä½œç”¨åŸŸä¸­ï¼Œè¢«è¿”å›çš„å¯¹è±¡é‡Œçš„æ–¹æ³•é€šè¿‡é—­åŒ…è®¿é—®å®ƒï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®å’Œä¿®æ”¹ã€‚

2. ### **åˆ›å»ºå·¥å‚å‡½æ•°**

**ç›®çš„**ï¼šæ ¹æ®ä¸åŒé…ç½®ç”Ÿæˆå¸¦çŠ¶æ€/è¡Œä¸ºçš„ä¸åŒå‡½æ•°/å¯¹è±¡

```JavaScript
function createGreeting(greeting: string) {
    return function(name: string) {
        return `${greeting}, ${name}!`
    }
}

const sayHello = createGreeting('Hello')
const sayHi = createGreeting('Hi')

console.log(sayHello('Alice')) // Hello, Alice!
console.log(sayHi('Bob'))      // Hi, Bob!
```

å†…éƒ¨å‡½æ•°â€œæºå¸¦â€å¤–éƒ¨å‚æ•°`greeting`ï¼Œæ¯æ¬¡è°ƒç”¨`createGreeting`éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œå½¢æˆä¸åŒè¡Œä¸ºã€‚

3. ### **ä¿æŒå‡½æ•°çŠ¶æ€ä¸è¢«å¤–éƒ¨ç›´æ¥ä¿®æ”¹**

**ç›®çš„**ï¼šå‡½æ•°èƒ½â€œè®°ä½â€ä¸Šä¸€æ¬¡è°ƒç”¨çš„çŠ¶æ€ï¼Œè€Œå¤–éƒ¨æ— æ³•ç›´æ¥å¹²é¢„ã€‚

```JavaScript
function makeStepCounter(step = 1) {
    let total = 0
    return function() {
        total += step
        return total
    }
}

const counterBy2 = makeStepCounter(2)
console.log(counterBy2()) // 2
console.log(counterBy2()) // 4
console.log(counterBy2()) // 6

const counterBy3 = makeStepCounter(3)
console.log(counterBy3()) // 3
console.log(counterBy3()) // 6
```

`total`æ˜¯å‡½æ•°å†…éƒ¨çš„ç§æœ‰çŠ¶æ€ï¼Œæ¯ä¸ªé—­åŒ…ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥ä¿®æ”¹`total`ã€‚

## 5ï¸âƒ£ å¸¸è§è¯¯åŒº

1. å¾ˆå¤šäººè¯¯ä»¥ä¸ºå¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œå°±é”€æ¯æ‰€æœ‰å˜é‡ï¼Œä½†é—­åŒ…ä¿ç•™äº†å˜é‡çš„å¼•ç”¨ã€‚
2. å¾ªç¯ä¸­åˆ›å»ºé—­åŒ…éœ€è¦æ³¨æ„`let`å’Œ`var`çš„åŒºåˆ«ï¼Œå¦åˆ™æ‰€æœ‰é—­åŒ…å°†å…±äº«ä¸€ä¸ªå˜é‡ã€‚

**ä¸¾ä¸ªğŸŒ°ï¼š**

1. **ä½¿ç”¨****`var`**

```JavaScript
var funcs = [];

for (var i = 0; i < 3; i++) {
    funcs.push(function() {
        console.log(i);
    });
}

funcs[0](); // 3
funcs[1](); // 3
funcs[2](); // 3
```

**ä¸ºä»€ä¹ˆè¾“å‡ºçš„éƒ½æ˜¯3ï¼Ÿ**

- `var i`æ˜¯å‡½æ•°ä½œç”¨åŸŸè€Œä¸æ˜¯å—ä½œç”¨åŸŸã€‚
- é—­åŒ…æ•è·çš„ä¸æ˜¯å½“å‰çš„å€¼ï¼Œè€Œæ˜¯`i`çš„å¼•ç”¨ã€‚
- å¾ªç¯ç»“æŸåï¼Œ`i`çš„å€¼ä¸º3ã€‚
- æ‰€æœ‰çš„é—­åŒ…éƒ½è®¿é—®äº†åŒä¸€ä¸ª`i`ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„ç»“æœéƒ½ä¸º3ã€‚

2. **ä½¿ç”¨****`let`**

```JavaScript
let funcs = [];

for (let i = 0; i < 3; i++) {
    funcs.push(function() {
        console.log(i);
    });
}

funcs[0](); // 0
funcs[1](); // 1
funcs[2](); // 2
```

**ä¸ºä»€ä¹ˆè¾“å‡ºä¸åŒï¼Ÿ**

- `let i`æ˜¯å—ä½œç”¨åŸŸï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„`i`
- é—­åŒ…è®¿é—®çš„æ˜¯å½“æ¬¡å¾ªç¯çš„`i`ã€‚
- æ¯ä¸ªé—­åŒ…å†…éƒ¨éƒ½æ˜¯ç‹¬ç«‹çš„`i`ï¼Œæ‰€ä»¥è¾“å‡ºä¸åŒã€‚

3. **æ—§æ–¹æ³•ï¼šä½¿ç”¨ IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰**

```JavaScript
var funcs = [];

for (var i = 0; i < 3; i++) {
    (function(j) {
        funcs.push(function() {
            console.log(j);
        });
    })(i);
}

funcs[0](); // 0
funcs[1](); // 1
funcs[2](); // 2
```

- æ¥å—å¾ªç¯å˜é‡`i`ä½œä¸ºå‚æ•°`j`ã€‚
- æ¯æ¬¡å¾ªç¯éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„é—­åŒ…ï¼Œæ•è·ä¸åŒçš„`j`ã€‚

## 6ï¸âƒ£ é—­åŒ…çš„ç¼ºç‚¹

1. **å†…å­˜å ç”¨å¢åŠ **ï¼šé—­åŒ…ä¼šæŒæœ‰å¯¹å¤–éƒ¨å‡½æ•°å˜é‡çš„å¼•ç”¨ï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œè¿™äº›å˜é‡ä¾ç„¶ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœåˆ›å»ºäº†å¤§é‡é—­åŒ…ä½†ä¸é‡Šæ”¾ï¼Œä¼šå¢åŠ å†…å­˜å ç”¨ã€‚
2. **è°ƒè¯•å›°éš¾**ï¼šé—­åŒ…çš„ä½œç”¨åŸŸé“¾å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œå°¤å…¶æ˜¯åµŒå¥—é—­åŒ…æˆ–è€…å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨é—­åŒ…ã€‚å˜é‡æ˜¯â€œéšè—çš„â€ï¼Œå¾ˆéš¾ç›´æ¥çœ‹åˆ°ä»–ä»¬å½“å‰çš„å€¼ã€‚è°ƒè¯•æ—¶å®¹æ˜“æ··æ·†å“ªäº›å˜é‡æ˜¯å…±äº«çš„ï¼Œå“ªäº›æ˜¯ç‹¬ç«‹çš„ã€‚

## 7ï¸âƒ£ å®è·µç»ƒä¹ 

1. ### æŸ¯é‡ŒåŒ–å‡½æ•°

```JavaScript
function curry(fn) {
    let len = fn.length
    
    return function curried(...args) {
        if(args.length >= len) {
            return fn.apply(this, args)
        } else {
            return function(...args2) {
                return curried.apply(this, args.concat(args2))
            }
        }
    }
}

const curriedAdd = curry(function(a,b,c){
    return a+b+c
})
curriedAdd(1)(2)(3)
console.log(curriedAdd(1)(2)(3));
console.log(curriedAdd(1, 2)(3)); // è¾“å‡º6
```

2. ### é˜²æŠ–ä¸èŠ‚æµ

```JavaScript
// èŠ‚æµ
function throttle(fn, timeout) {
    let timer = null
    return function(...arg) {
        if(timer) return
        timer = setTimeout(()=>{
            fn.apply(this,arg)
            timer = null
        },timeout)
    }
}

//é˜²æŠ–
function debounce(fn, timeout) {
    let timer = null
    return function(...arg) {
        clearTimeout(timer)
        timer = setTimeout(()=>{
            fn.apply(this,arg)
        },timeout)
    }
}
```

3. ### å‡½æ•°ä½œä¸ºå‚æ•°

```JavaScript
function test(fn) {
    fn('done')
}
test(function(msg) {
    console.log(msg)
})
```