---
title: 作用域是什么？Javascript中有哪些作用域？
date: 2025-11-20 22:25:21
tags: 
  - JavaScript
  - 前端基础
cover: https://cdn.jsdelivr.net/gh/iiuoud/cdn@1.0/scope.jpg
---

# 【作用域】— 变量在哪些地方能被看到？

## 1️⃣ 问题引入

1. 为什么说 JavaScript 是词法作用域？
2. 为什么函数内部可以访问外部变量？
3. 为什么 `for `循环里，用 `var `会出 `bug`？
4. 函数作用域和块级作用域有什么区别？

## 2️⃣ 概念解释

**作用域**是指在程序中定义**变量、函数和对象**的**可访问性**和**生命周期范围**。简单来说，作用域规定了在代码中某些特定位置可以访问哪些变量。就像教室里的物品，只有在教室里的人可以看到，出了教室就看不到了。

作用域分为：**全局作用域**、**局部作用域**、**块级作用域**。

全局作用域相当于整栋学校，范围最大；局部作用域相当于一个教室；而块级作用域相当于教室的某一小组围圈讨论。

1. ### 全局作用域

全局作用域中的变量和函数在代码中的任何地方都可被访问。在代码的最外层定义的变量和函数属于全局作用域。在浏览器环境下，全局作用域通常是`window`对象，在`nodejs`下，通常是`global`对象。

**举个🌰**：

```JavaScript
var value = 1
function foo() {
    console.log(value)
}
function bar() {
    var value = 2
    foo()
}
bar() // 结果是？
```

当执行`bar()`，输出1，以下为解释：

1. **全局变量声明**：`var value = 1`：声明全局变量value，值为1。
2. **定义****`foo`****函数**，当`foo`被调用时，会打印`value`的值，由于函数内部没有`value`值的定义，所以向上查找到全局作用域中的`value`。
3. **定义****`bar`****函数**，`bar`函数声明了一个局部变量`value`，然后调用了`foo`函数。

当`bar`函数被调用时，内部的局部变量`value`被设置为2，当`foo`在`bar`中被调用时，`foo`自身没有`value`的定义，会向上查到全局作用域，因此输出为1。

这个例子的重点在于理解 Javascript 的**作用域****链**。**函数的作用域在创建的时候就已经决定了**，而不是在运行时决定。函数 `foo` 访问的是它定义时的作用域，而不是调用时的作用域。即使`foo`是在`bar`中调用的，也与`bar`中的`value`无关，它只会访问全局的作用域。

2. ### 局部作用域

函数定义或者创建代码块时，会创建一个局部作用域。在局部作用域中可以访问上层作用域的内容。局部作用域之间是**隔离**的。

**举个🌰**：

```JavaScript
  var value = 1;
  console.log(value);

  function test() {
    console.log(value);
    var value = 2;
  }

  test(); //输出undefined
```

调用`test`函数时，`test`函数内部存在`value`的定义，JavaScript 中`var`声明变量存在变量提升的问题，所以`value`被提升定义并初始化为`undefined`，但是值不会被提升，所以此时打印`value`打印的是`undefined`。

3. ### 块级作用域

使用`let`和`const`声明的变量具有块级作用域，这些变量仅在它所在的代码块内部有效。

**举个**🌰：

```JavaScript
{
  let c = 30;
  const d = 40;
  console.log(c, d); // 30 40
}
console.log(c, d); // 报错，c 和 d 未定义
```

`let`和`const`受块级作用域的限制，`c`和`d`仅在`{}`内可见。

## 3️⃣ 词法作用域

作用域在代码定义阶段就确定了，而不会在运行阶段改变。

当JavaScript引擎加载代码时（还未开始执行）

1. 创建作用域
2. 根据函数定义的位置，绑定外部变量的查找路径（作用域链）
3. 整个结构就固定住了

即使函数被返回、传到别的地方、延迟执行等等操作，函数的作用域链都不会被改变。

这就是闭包产生的原因。

## 4️⃣ 作用域的查找规则

- 在当前的作用域进行查找。
- 如果找不到，则向上层作用域继续查找。
- 直到找到全局作用域为止，若全局作用域也找不到，则报错。
- 只能从内向外查找，不能从外向内查找。

## 5️⃣ 为什么函数内部可以访问外部变量？

当JavaScript创建一个函数时，它会同时记录

- 这个函数的代码
- 当时它所处的作用域链（外部环境）

可以想象为，当一个函数出生的时候，给它周围的变量都拍了一个全家福，无论以后走到哪里，这张全家福都会被带着。

## 6️⃣ 为什么 `for `循环里，用 `var `会出 `bug`？

**举个**🌰：

```JavaScript
var funcs = [];

for (var i = 0; i < 3; i++) {
    funcs.push(function() {
        console.log(i);
    });
}

funcs[0](); // ?
funcs[1](); // ?
funcs[2](); // ?
```

最后的输出结果都是3。

- `var`是函数作用域，`var`声明不受块`{}`限制，只在当前函数或全局作用域有效。上述例子中，`i`是全局或函数作用域变量，而不是每次循环的独立副本。
- 闭包捕获的是变量引用，而不是值，`funcs.push`里创建的函数形成闭包，会捕获`i`的引用。循环结束后，`i=3`。调用闭包函数时，它们调用的是同一个`i`。

## 7️⃣ 函数作用域和块级作用域有什么区别？

1. ### **范围**

- 函数作用域
  - 由整个函数体形成。
  - 内部可以访问外部变量，外部无法访问内部。
- 块级作用域
  - 由一对`{}`代码块形成，比如`if`，`while`，`for`或单独的`{}`。

2. ### **变量声明**

- `var`声明的变量遵循函数作用域。
- `let`和`const`声明的变量遵循块级作用域。

3. ### **生命周期**

- 函数作用域：在函数执行时创建，函数执行完毕后，如果没有闭包引用，会被垃圾回收。
- 块级作用域：在进入块时创建，离开块后会被回收（没有闭包引用的情况下）。
